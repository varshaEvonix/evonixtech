<%- include ../admin/admin_head.ejs %>
<%- include ../admin/sidebar.ejs %>

<section id="main-content">
    <section class="wrapper">

        <div class="row">
            <div class="col-lg-12 main-chart white_bg">
                <h1 class="phead">Payout Details</h1><br>
                <div class="col-sm-4">
                    Student Name : <strong><%= post[0].student_firstname %> <%= post[0].student_lastname %></strong>
                </div>
                <div class="col-sm-4">
                    Student Email : <strong><%= post[0].student_email %></strong>
                </div>
                <div class="col-sm-4">
                    Loan Amount : $ <strong><%= post[0].loan_amount %></strong>
                </div>

            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 main-chart white_bg">
                <form action="#" method="POST" >
                <div class="col-md-8">
                    <h1 class="phead">Pending Payouts</h1><br>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Payouts Pending</th>
                                <th>Payout Amount Pending</th>
                            </tr>
                        </thead>
                        <tbody
                            <% if(post.length > 0){ %>
                            <% _.each(post, function (values) { %>

                            <tr class="payout-row">
                                <td><input class="payout-record" type="checkbox" name="student_record[]" data="<%= values.funded_amount %>" data-value="<%= values.balance_to_transfer %>"  value="<%= values.donors_id %>"></td>
                                <td>
                                    <%= values.donors_name %>
                                </td>
                                <td> <%= values.donor_email %></td>
                                <td>$ <%= values.funded_amount %></td>
                                <td>$ <%= values.balance_to_transfer %></td>
                            </tr>

                            <% }) %>
                            <% }else{ %>
                            <tr>
                                <td>
                                    No Record Found
                                </td>
                            </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
                <div class="col-md-4">
                    <h1 class="phead">Payouts</h1><br><br>
                    <div class="form-group row">
                        <div class="col-sm-6">
                            <label>Funded Amount Total :</label>
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon">$</span><input id="funded_amount_total" class="form-control" value="" name="funded_amount_total">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-6">
                            <label>Payout Amount Total :</label>
                        </div>
                        <div class="input-group">
                            <span class="input-group-addon">$</span><input id="payout_amount_total" value="" class="form-control" name="payout_amount_total">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-6">
                            <label>Note:</label>
                        </div>
                        <div class="input-group">
                            <textarea class="form-control" name="payout_note"></textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <input type="submit" ng-click="submitted = true" class="btn btn-primary col-xs-offset-5" value="Submit">
                    </div>
                </div>
                    </form>
            </div> 
        </div>
    </section>
</section>
<%- include ../admin/stufoot.ejs %>
<link href="../../index_files/stdash/css/sweetalert.css" rel="stylesheet">
<script src="../../index_files/stdash/js/sweetalert.min.js"></script>
<script src="../../index_files/stdash/js/sweetalert-dev.js"></script>
<script>
    $(document).ready(function () {
        $('.change_status').click(function () {
            var status = $(this).attr('data-value') == '0' ? 'De-activate' : 'Activate';
            var stu_status = $(this).attr('data-value');
            var student_id = $(this).attr('data');
            swal({title: "Are you sure?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, " + status + " it!",
                closeOnConfirm: false
            },
            function () {

                $.ajax({
                    url: "/change_status",
                    type: "POST",
                    async: true,
                    dataType: 'json',
                    data: {student_id: student_id, stu_status: stu_status},
                    //your form data to post goes here
                    success: function (response) {
                        window.location.reload();
                    }
                });

            });
        });
        var funded_amount = 0;
        var payout_amount = 0;
        $('.payout-record').change(function () {

            if ($(this).prop('checked') == true) {
                funded_amount = parseInt(funded_amount) + parseInt($(this).attr('data'));
                payout_amount = parseInt(payout_amount) + parseInt($(this).attr('data-value'));
            } else {
                if (funded_amount >= 0 && payout_amount >= 0) {
                    funded_amount = parseInt(funded_amount) - parseInt($(this).attr('data'));
                    payout_amount = parseInt(payout_amount) - parseInt($(this).attr('data-value'));
                }
            }
            $('#funded_amount_total').val(funded_amount);
            $('#payout_amount_total').val(payout_amount);
        });
    });
</script>
<script>
    $('#payouts').addClass('active');
    $('#donors-management').addClass('active');
</script>